{{ template "head" . }}

{{ template "prom_right_table_head" }}
{{ template "prom_right_table_tail" }}
{{ template "prom_content_head" . }}

<h1>lnmon</h1>

<h2>Lightning</h2>

<h3>Channels</h3>

<p>Number of channels in each state:</p>
<table>
	<tr>
		<th>State</th>
		<th>Number</th>
	</tr>
	{{ range query "lightningd_our_channels" }}
	<tr>
		<td>
			<code>{{ .Labels.state }}</code>
		</td>
		<td>
			{{ .Value }}
		</td>
	</tr>
{{ end }}
</table>

<p>Balance of our outbound channels in state <code>CHANNELD_NORMAL</code>:</p>
<table>
	<tr>
		<th>Balance</th>
		<th>Node id</th>
	</tr>
	{{ range query "job_lightningd:channel_balances_normal_btc:max{direction='to_us'}" }}
	<tr>
		<td>
			{{ .Value }} BTC
		</td>
		<td>
			<code>{{ .Labels.node_id }}</code>
		</td>
	</tr>
	{{ end }}
</table>

<p>Balance of our inbound channels in state <code>CHANNELD_NORMAL</code>:</p>
<table>
	<tr>
		<th>Balance</th>
		<th>Node id</th>
	</tr>
	{{ range query "job_lightningd:channel_balances_normal_btc:max{direction='to_them'}" }}
	<tr>
		<td>
			{{ .Value }} BTC
		</td>
		<td>
			<code>{{ .Labels.node_id }}</code>
		</td>
	</tr>
{{ end }}
</table>

<p>Alias for node %s:
{{ with printf "job_lightningd:aliases:sum{node_id='%s'}" .Params.node_id | query }}
  {{ . | first | .Params.alias}}
  {{ end }}
</p>

<h4>Number of channels to and from our node</h4>
<div id="ourChannelsGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#ourChannelsGraph"),
    expr: "lightningd_our_channels",
    renderer: "area",
    min: 0.0
});
</script>

<h4>Capacity of our channels</h4>

<div id="channelCapacityGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#channelCapacityGraph"),
    expr: 'job_lightningd:channel_capacities_msatoshi:max/100000000000',
    renderer: "area",
    yUnits: "BTC",
    yTitle: "Capacity",
    min: 0.0
});
</script>

<h4>Balance to us in our channels</h4>

<div id="channelToUsBalanceGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#channelToUsBalanceGraph"),
    expr: 'job_lightningd:channel_balances_msatoshi:max{direction="to_us"}/100000000000',
    renderer: "area",
    yUnits: "BTC",
    yTitle: "Balance",
    min: 0.0
});
</script>

<h4>Balance to them in our channels</h4>

<div id="channelToThemBalanceGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#channelToThemBalanceGraph"),
    expr: 'job_lightningd:channel_balances_msatoshi:max{direction="to_them"}/100000000000',
    renderer: "area",
    yUnits: "BTC",
    yTitle: "Balance",
    min: 0.0
});
</script>

<h4>Funds available to open channels</h4>
<div id="fundsGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#fundsGraph"),
    expr: 'lightningd_total_funds/100000000',
    renderer: "area",
    yUnits: "BTC",
    yTitle: "Funds",
    min: 0.0
});
</script>

<h4>Number of channels on the network</h4>
<div id="numChannelsGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#numChannelsGraph"),
    expr: "lightningd_num_channels",
    renderer: "area",
    min: 0.0,
    yTitle: "Number of channels"
});
</script>

<h3>Nodes</h3>

<h4>Number of peers</h4>
<div id="numPeersGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#numPeersGraph"),
    expr: "lightningd_num_peers",
    renderer: "area",
    min: 0.0
});
</script>

<h4>Number of total known nodes on the network</h4>
<div id="numNodesGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#numNodesGraph"),
    expr: "lightningd_num_nodes",
    renderer: "area",
    min: 0.0
});
</script>

<h2>Process info for <code>lightningd</code></h2>

<h3>Virtual memory usage</h3>
<div id="virtualMemoryGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#virtualMemoryGraph"),
    expr: 'pid_process_virtual_memory_bytes{job="lnmon"}',
    renderer: "area",
    min: 0.0
});
</script>

<h3>Resident memory</h3>
<div id="residentMemoryGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#residentMemoryGraph"),
    expr: 'pid_process_resident_memory_bytes{job="lnmon"}',
    renderer: "area",
    min: 0.0
});
</script>

<h3>Rate of CPU usage</h3>
<div id="cpuUsageRateGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#cpuUsageRateGraph"),
    expr: 'rate(pid_process_cpu_seconds_total{job="lnmon"}[5m])',
    renderer: "area",
    min: 0.0
});
</script>

<h3>Number of open file descriptors</h3>
<div id="openFdsGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#openFdsGraph"),
    expr: 'pid_process_open_fds{job="lnmon"}',
    renderer: "area",
    min: 0.0
});
</script>

<h3>Start time of process</h3>
<div id="startTimeGraph"></div>
<script>
new PromConsole.Graph({
    node: document.querySelector("#startTimeGraph"),
    expr: 'pid_process_start_time_seconds{job="lnmon"}',
    renderer: "area",
    min: 0.0
});
</script>

{{ template "prom_content_tail" . }}

{{ template "tail" }}
