set -euo pipefail

VERSION=nixos-19.03
BRANCH=20190726-crypto

echo "Refreshing ${BRANCH}.."
cd /home/user/src/hkjn.me/nixpkgs
git checkout ${BRANCH}
git fetch upstream
echo "Refreshing channels.."
git fetch channels
echo "Rebasing ${BRANCH} on top of ${VERSION}.."
git rebase channels/${VERSION}
echo "Rebasing nixos-unstable.."
git checkout nixos-unstable
git rebase remotes/channels/nixos-unstable

